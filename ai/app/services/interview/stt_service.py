from pydub import AudioSegment
import openai
import os
from dotenv import load_dotenv


# ğŸ“¦ .env í™˜ê²½ ë³€ìˆ˜ ë¡œë“œ
dotenv_path = os.path.join(os.path.dirname(__file__), '..', '..', '.env')
load_dotenv(dotenv_path)

# ğŸ”‘ OpenAI API Key ë¡œë“œ ë° í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
openai_key = os.getenv("OPENAI_API_KEY")
if not openai_key:
    raise ValueError("âŒ OPENAI_API_KEYê°€ .envì— ì •ì˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
openai.api_key = os.getenv("OPENAI_API_KEY")

#ğŸ§  OpenAI Whisper APIë¥¼ í†µí•œ STT ìˆ˜í–‰
def transcribe_audio_file(file_path: str) -> str:
    """
    Whisper APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì£¼ì–´ì§„ ì˜¤ë””ì˜¤ íŒŒì¼ì„ í…ìŠ¤íŠ¸ë¡œ ì „ì‚¬í•¨
    """
    with open(file_path, "rb") as f:
        transcript = openai.Audio.transcribe(
            model="whisper-1",
            file=f,
            response_format="text"
        )
    return transcript.strip()
